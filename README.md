# Cloudflare Auto DDNS

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.7+](https://img.shields.io/badge/python-3.7+-blue.svg)](https://www.python.org/downloads/)

ğŸš€ **æ™ºèƒ½æ—¶é—´æ®µDNSè§£æåˆ‡æ¢å·¥å…·** - æ ¹æ®æ—¶é—´æ®µè‡ªåŠ¨åˆ‡æ¢Cloudflare DNSè®°å½•çš„IPåœ°å€

## ğŸŒŸ ç‰¹æ€§

- â° **æ—¶é—´æ®µåˆ‡æ¢**: æ”¯æŒæŒ‰æ—¶é—´æ®µè‡ªåŠ¨åˆ‡æ¢IPï¼ˆå¦‚ç™½å¤©/å¤œé—´ä¸åŒçº¿è·¯ï¼‰
- ğŸ¯ **ç²¾ç¡®æ›¿æ¢**: åªæ›¿æ¢æŒ‡å®šçš„IPè®°å½•ï¼Œå®Œå…¨ä¿ç•™åŸŸåçš„å…¶ä»–è§£æè®°å½•
- ğŸ”„ **æ™ºèƒ½åŒæ­¥**: è‡ªåŠ¨å‘ç°å¹¶åŒæ­¥æ‰€æœ‰ä½¿ç”¨ç›®æ ‡IPçš„åŸŸåï¼ˆåŒ…æ‹¬æœªé…ç½®çš„åŸŸåï¼‰
- ğŸ›¡ï¸ **å®‰å…¨å¯é **: å®Œæ•´çš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•ï¼Œä¸ä¼šè¯¯åˆ å…¶ä»–DNSè®°å½•
- ğŸ”§ **æ˜“äºé…ç½®**: JSONé…ç½®æ–‡ä»¶ï¼Œæ”¯æŒçƒ­æ›´æ–°
- ğŸš€ **systemdé›†æˆ**: ä½œä¸ºç³»ç»ŸæœåŠ¡è¿è¡Œï¼Œå¼€æœºè‡ªå¯
- ğŸ“Š **å®Œå–„ç›‘æ§**: è¯¦ç»†çš„æ—¥å¿—å’ŒçŠ¶æ€ç›‘æ§
- ğŸŒ **å¤šåœºæ™¯æ”¯æŒ**: é€‚ç”¨äºCDNåˆ‡æ¢ã€çº¿è·¯ä¼˜åŒ–ã€è´Ÿè½½å‡è¡¡ç­‰åœºæ™¯

## ğŸ¯ ä½¿ç”¨åœºæ™¯

- **CDNçº¿è·¯åˆ‡æ¢**: ç™½å¤©ä½¿ç”¨é«˜é€Ÿçº¿è·¯ï¼Œå¤œé—´ä½¿ç”¨ç»æµçº¿è·¯
- **è´Ÿè½½å‡è¡¡**: æ ¹æ®æ—¶é—´æ®µåˆ†é…ä¸åŒçš„æœåŠ¡å™¨
- **ç½‘ç»œä¼˜åŒ–**: æ ¹æ®ç½‘ç»œçŠ¶å†µè‡ªåŠ¨åˆ‡æ¢è§£æ
- **æˆæœ¬æ§åˆ¶**: åœ¨ä¸åŒæ—¶æ®µä½¿ç”¨ä¸åŒæˆæœ¬çš„æœåŠ¡

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.7+
- Linuxç³»ç»Ÿï¼ˆæ¨èUbuntu/Debian/CentOSï¼‰
- Cloudflareè´¦æˆ·å’ŒAPI Token
- systemdæ”¯æŒï¼ˆå¯é€‰ï¼Œç”¨äºæœåŠ¡ç®¡ç†ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šäº¤äº’å¼ä¸€é”®å®‰è£… (æ¨è)

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/cloudflare-auto-ddns.git
cd cloudflare-auto-ddns

# è¿è¡Œäº¤äº’å¼å®‰è£…è„šæœ¬
sudo ./install.sh
```

**å®‰è£…è„šæœ¬ä¼šå¼•å¯¼æ‚¨å®Œæˆï¼š**
- ğŸ”‘ Cloudflareè´¦æˆ·é…ç½® (é‚®ç®± + API Token)
- ğŸŒ æ—¶åŒºé€‰æ‹© (åŒ…å«åŒ—äº¬æ—¶é—´ç­‰å¸¸ç”¨æ—¶åŒº)
- â° æ—¶é—´æ®µè®¾ç½® (ç™½å¤©/å¤œé—´åˆ‡æ¢æ—¶é—´)
- ğŸŒ IPåœ°å€é…ç½® (ç™½å¤©IP + å¤œé—´IP)
- ğŸ“ åŸŸåé…ç½® (å¯é€‰ï¼Œæ”¯æŒæ™ºèƒ½å‘ç°)
- âš™ï¸ ç³»ç»Ÿè®¾ç½® (æ£€æŸ¥é—´éš”ç­‰)
- ğŸš€ è‡ªåŠ¨å®‰è£…å¹¶å¯åŠ¨æœåŠ¡

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨é…ç½®å®‰è£…

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/your-username/cloudflare-auto-ddns.git
cd cloudflare-auto-ddns

# å®‰è£…ä¾èµ–
pip3 install -r requirements.txt

# å¤åˆ¶é…ç½®æ¨¡æ¿å¹¶ç¼–è¾‘
cp config.example.json config.json
nano config.json

# è¿è¡Œå®‰è£…è„šæœ¬
sudo ./setup.sh
```

é…ç½®ç¤ºä¾‹ï¼š

```json
{
  "cloudflare": {
    "email": "your-email@example.com",
    "api_token": "your-cloudflare-api-token"
  },
  "schedule": {
    "day_start_hour": 6,
    "day_end_hour": 22,
    "day_ip": "1.2.3.4",
    "night_ip": "5.6.7.8"
  },
  "domains": [
    {
      "name": "example.com",
      "zone": "example.com",
      "type": "A"
    },
    {
      "name": "www.example.com", 
      "zone": "example.com",
      "type": "A"
    }
  ],
  "check_interval": 300
}
```

### 3. è·å–Cloudflare API Token

1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/profile/api-tokens)
2. ç‚¹å‡» "Create Token"
3. ä½¿ç”¨ "Custom token" æ¨¡æ¿
4. è®¾ç½®æƒé™ï¼š
   - Zone: Zone:Read
   - Zone: DNS:Edit
5. è®¾ç½®Zone Resourcesï¼šé€‰æ‹©æ‚¨è¦ç®¡ç†çš„åŸŸå
6. å¤åˆ¶ç”Ÿæˆçš„Token

### 4. è¿è¡Œ

#### æ‰‹åŠ¨æµ‹è¯•

```bash
# æµ‹è¯•è¿è¡Œ
python3 auto_ddns.py config.json
```

#### å®‰è£…ä¸ºç³»ç»ŸæœåŠ¡

```bash
# è¿è¡Œå®‰è£…è„šæœ¬
sudo ./setup.sh

# å¯åŠ¨æœåŠ¡
sudo systemctl start cloudflare-auto-ddns
sudo systemctl enable cloudflare-auto-ddns
```

#### æœåŠ¡ç®¡ç†

**æ–¹å¼ä¸€ï¼šä½¿ç”¨äº¤äº’å¼ç®¡ç†è„šæœ¬ (æ¨è)**
```bash
# è¿è¡Œäº¤äº’å¼ç®¡ç†å·¥å…·
sudo ./manage.sh
```

**ç®¡ç†å·¥å…·åŠŸèƒ½ï¼š**
- ğŸ“Š æœåŠ¡ç®¡ç† (å¯åŠ¨/åœæ­¢/é‡å¯/çŠ¶æ€/æ—¥å¿—)
- âš™ï¸ é…ç½®ç®¡ç† (æ›´æ¢IP/ä¿®æ”¹æ—¶é—´æ®µ/ç®¡ç†åŸŸå)
- ğŸ” è‡ªåŠ¨å‘ç°è®¾ç½® (å¼€å¯/å…³é—­æ™ºèƒ½å‘ç°)
- ğŸ”§ é«˜çº§åŠŸèƒ½ (æµ‹è¯•è¿è¡Œ/ç¼–è¾‘é…ç½®/æ‰«æåŸŸå)

**æ–¹å¼äºŒï¼šä½¿ç”¨systemctlå‘½ä»¤**
```bash
# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status cloudflare-auto-ddns

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u cloudflare-auto-ddns -f

# é‡å¯æœåŠ¡
sudo systemctl restart cloudflare-auto-ddns

# åœæ­¢æœåŠ¡
sudo systemctl stop cloudflare-auto-ddns
```

**æ–¹å¼ä¸‰ï¼šä½¿ç”¨å¿«æ·å‘½ä»¤**
```bash
# å¦‚æœå®‰è£…æ—¶åˆ›å»ºäº†å¿«æ·å‘½ä»¤
cloudflare-auto-ddns status
cloudflare-auto-ddns logs
cloudflare-auto-ddns restart
```

## âš™ï¸ é…ç½®è¯´æ˜

### åŸºæœ¬é…ç½®

| å­—æ®µ | è¯´æ˜ | ç¤ºä¾‹ |
|------|------|------|
| `cloudflare.email` | Cloudflareè´¦æˆ·é‚®ç®± | `user@example.com` |
| `cloudflare.api_token` | Cloudflare API Token | `your-token` |
| `schedule.day_start_hour` | ç™½å¤©å¼€å§‹æ—¶é—´ï¼ˆ24å°æ—¶åˆ¶ï¼‰ | `6` (æ—©ä¸Š6ç‚¹) |
| `schedule.day_end_hour` | ç™½å¤©ç»“æŸæ—¶é—´ï¼ˆ24å°æ—¶åˆ¶ï¼‰ | `22` (æ™šä¸Š10ç‚¹) |
| `schedule.day_ip` | ç™½å¤©ä½¿ç”¨çš„IPåœ°å€ | `1.2.3.4` |
| `schedule.night_ip` | å¤œé—´ä½¿ç”¨çš„IPåœ°å€ | `5.6.7.8` |
| `check_interval` | æ£€æŸ¥é—´éš”ï¼ˆç§’ï¼‰ | `300` (5åˆ†é’Ÿ) |

### åŸŸåé…ç½®

```json
{
  "name": "åŸŸå",
  "zone": "æ ¹åŸŸå",
  "type": "è®°å½•ç±»å‹"
}
```

## ğŸ”§ é«˜çº§åŠŸèƒ½

### ğŸ” æ™ºèƒ½å‘ç°åŠŸèƒ½

**å¯é€‰çš„æ™ºèƒ½å‘ç°åŠŸèƒ½ï¼** ç³»ç»Ÿå…·æœ‰å¼ºå¤§çš„æ™ºèƒ½å‘ç°åŠŸèƒ½ï¼Œå¯ä»¥é€‰æ‹©å¼€å¯æˆ–å…³é—­ï¼š

#### ğŸŸ¢ å¼€å¯æ™ºèƒ½å‘ç° (æ¨è)
- âœ… **è‡ªåŠ¨æ‰«æ**: æ‰«ææ‚¨Cloudflareè´¦æˆ·ä¸­çš„æ‰€æœ‰Zone
- âœ… **æ™ºèƒ½è¯†åˆ«**: è‡ªåŠ¨å‘ç°ä½¿ç”¨ç›®æ ‡IPçš„æ‰€æœ‰åŸŸå
- âœ… **è‡ªåŠ¨ç®¡ç†**: å³ä½¿æœªåœ¨é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„åŸŸåä¹Ÿä¼šè¢«è‡ªåŠ¨ç®¡ç†
- âœ… **å®æ—¶ç”Ÿæ•ˆ**: æ–°æ·»åŠ çš„åŸŸåä¼šåœ¨ä¸‹æ¬¡æ£€æŸ¥æ—¶è‡ªåŠ¨åŠ å…¥ç®¡ç†

#### ğŸ”’ å…³é—­æ™ºèƒ½å‘ç° (ç²¾ç¡®æ§åˆ¶)
- ğŸ”’ **ç²¾ç¡®æ§åˆ¶**: åªç®¡ç†æ‰‹åŠ¨é…ç½®çš„åŸŸååˆ—è¡¨
- ğŸ”’ **é¿å…æ„å¤–**: é¿å…è¯¯æ“ä½œå…¶ä»–æ°å¥½ä½¿ç”¨ç›¸åŒIPçš„åŸŸå
- ğŸ”’ **å¤æ‚ç¯å¢ƒ**: é€‚åˆå¤æ‚DNSé…ç½®ç¯å¢ƒ

#### ğŸ“ é…ç½®æ–¹å¼
```json
{
  "auto_discovery": true,   // å¼€å¯æ™ºèƒ½å‘ç°
  "auto_discovery": false   // å…³é—­æ™ºèƒ½å‘ç°
}
```

#### ğŸ¯ ä½¿ç”¨åœºæ™¯ç¤ºä¾‹
**åœºæ™¯1**: æ‚¨æœ‰ `1.example.com` è§£æåˆ° `2.2.2.2`ï¼ŒåŒæ—¶ `2.example.com` ä¹Ÿæ°å¥½è§£æåˆ° `2.2.2.2`
- **å¼€å¯æ™ºèƒ½å‘ç°**: ä¸¤ä¸ªåŸŸåéƒ½ä¼šè¢«è‡ªåŠ¨ç®¡ç†
- **å…³é—­æ™ºèƒ½å‘ç°**: åªæœ‰æ‰‹åŠ¨é…ç½®çš„åŸŸåä¼šè¢«ç®¡ç†

**å·¥ä½œåŸç†ï¼š**
1. ç¨‹åºæ‰«ææ‚¨çš„æ‰€æœ‰Cloudflare Zone
2. æŸ¥æ‰¾ä½¿ç”¨ç™½å¤©IPæˆ–å¤œé—´IPçš„Aè®°å½•
3. æ ¹æ®è®¾ç½®å†³å®šæ˜¯å¦è‡ªåŠ¨ç®¡ç†è¿™äº›åŸŸå
4. æŒ‰æ—¶é—´æ®µè‡ªåŠ¨åˆ‡æ¢IP

**ä¾‹å¦‚ï¼š** æ‚¨åœ¨Cloudflareæ–°å¢äº† `new.example.com` å¹¶è®¾ç½®ä¸ºç®¡ç†çš„IPä¹‹ä¸€ï¼š
- å¼€å¯æ™ºèƒ½å‘ç°ï¼šç³»ç»Ÿä¼šåœ¨5-10åˆ†é’Ÿå†…è‡ªåŠ¨å‘ç°å¹¶å¼€å§‹ç®¡ç†
- å…³é—­æ™ºèƒ½å‘ç°ï¼šéœ€è¦æ‰‹åŠ¨æ·»åŠ åˆ°é…ç½®æ–‡ä»¶æ‰ä¼šè¢«ç®¡ç†

### ğŸ›¡ï¸ å¤šIPä¿æŠ¤

å¦‚æœåŸŸåæœ‰å¤šä¸ªAè®°å½•ï¼Œç³»ç»Ÿåªä¼šæ›´æ–°åŒ…å«ç®¡ç†IPçš„è®°å½•ï¼Œå®Œå…¨ä¿ç•™å…¶ä»–IPè§£æï¼š

- åªæ›¿æ¢æŒ‡å®šçš„ç™½å¤©/å¤œé—´IP
- ä¿ç•™åŸŸåçš„å…¶ä»–IPè§£æè®°å½•  
- ä¸å½±å“CNAMEã€MXç­‰å…¶ä»–ç±»å‹è®°å½•
- æ”¯æŒå¤šIPè´Ÿè½½å‡è¡¡åœºæ™¯

### ğŸ”„ é”™è¯¯æ¢å¤

ç³»ç»Ÿå…·æœ‰å®Œå–„çš„é”™è¯¯å¤„ç†æœºåˆ¶ï¼Œé‡åˆ°ç½‘ç»œé—®é¢˜æˆ–APIé”™è¯¯æ—¶ä¼šè‡ªåŠ¨é‡è¯•ã€‚

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

### æ—¥å¿—ä½ç½®

- ç³»ç»Ÿæ—¥å¿—: `/var/log/cloudflare-auto-ddns.log`
- systemdæ—¥å¿—: `journalctl -u cloudflare-auto-ddns`

### æ—¥å¿—æ ¼å¼

```
2025-01-01 12:00:00 - INFO - ğŸš€ Cloudflare Auto DDNS å¯åŠ¨
2025-01-01 12:00:01 - INFO - âœ… æˆåŠŸæ›´æ–° example.com: 1.2.3.4 -> 5.6.7.8
2025-01-01 12:00:02 - INFO - â° æ¯ 300 ç§’æ£€æŸ¥ä¸€æ¬¡
```

## ğŸ”’ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **API Tokenå®‰å…¨**: é…ç½®æ–‡ä»¶æƒé™è®¾ç½®ä¸º600ï¼Œä»…å½“å‰ç”¨æˆ·å¯è®¿é—®
2. **æœ€å°æƒé™åŸåˆ™**: API Tokenåªæˆäºˆå¿…è¦çš„DNSç¼–è¾‘æƒé™
3. **æ—¥å¿—å®‰å…¨**: æ•æ„Ÿä¿¡æ¯ä¸ä¼šè®°å½•åˆ°æ—¥å¿—ä¸­
4. **ç½‘ç»œå®‰å…¨**: æ‰€æœ‰APIè¯·æ±‚ä½¿ç”¨HTTPSåŠ å¯†

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **APIè®¤è¯å¤±è´¥**
   - æ£€æŸ¥API Tokenæ˜¯å¦æ­£ç¡®
   - ç¡®è®¤Tokenæƒé™åŒ…å«Zoneå’ŒDNSè®°å½•ç®¡ç†

2. **DNSæ›´æ–°å¤±è´¥**
   - æ£€æŸ¥åŸŸåæ˜¯å¦å­˜åœ¨äºCloudflare
   - ç¡®è®¤Zoneé…ç½®æ­£ç¡®

3. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   - æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
   - æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

### æµ‹è¯•å‘½ä»¤

```bash
# éªŒè¯é…ç½®æ–‡ä»¶
python3 -c "import json; json.load(open('config.json'))"

# æ‰‹åŠ¨æµ‹è¯•
python3 auto_ddns.py config.json

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
systemctl status cloudflare-auto-ddns
```

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤Issueå’ŒPull Requestï¼

1. Forkæœ¬é¡¹ç›®
2. åˆ›å»ºç‰¹æ€§åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. å¼€å¯Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä½¿ç”¨ MIT è®¸å¯è¯ã€‚è¯¦æƒ…è¯·å‚é˜… [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ“ æ”¯æŒ

- ğŸ› [é—®é¢˜åé¦ˆ](https://github.com/your-username/cloudflare-auto-ddns/issues)
- ğŸ’¡ [åŠŸèƒ½è¯·æ±‚](https://github.com/your-username/cloudflare-auto-ddns/issues)
- ğŸ“– [Wikiæ–‡æ¡£](https://github.com/your-username/cloudflare-auto-ddns/wiki)

## ğŸ™ è‡´è°¢

æ„Ÿè°¢æ‰€æœ‰è´¡çŒ®è€…å’Œä½¿ç”¨è€…çš„æ”¯æŒï¼

---

**â­ å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™ä¸ªStarï¼**
